<!DOCTYPE html>
<html lang="vi">
<head>
<!-- ================= META CLIENT PARAM BUILDER ================= -->
<script>
window.addEventListener('load', function () {
  var s = document.createElement('script');
  s.src = 'https://capi-automation.s3.us-east-2.amazonaws.com/public/client_js/capiParamBuilder/clientParamBuilder.bundle.js';
  s.onload = function () {
    try {
      if (!window.RW_EVENT_ID) {
        window.RW_EVENT_ID = crypto.randomUUID();
      }

      clientParamBuilder.processAndCollectAllParams(
        window.location.href,
        async () => {
          try {
            return await (await fetch('https://api64.ipify.org')).text();
          } catch { return ''; }
        }
      );
    } catch (e) {
      console.warn('CAPI init failed', e);
    }
  };
  document.body.appendChild(s);
});
</script>
<script src="/js/rw-event-id.js"></script>


   <!-- End Meta Pixel Code -->

    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '862531473384426');
        fbq('track', 'PageView');
    </script>
    <!-- End Meta Pixel Code -->

  <!-- Meta Tags Hoàn Chỉnh -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
  
  <title>QR Menu Generator | Trình Tạo Mã QR Miễn Phí - Ruby Wings Travel</title>
  <meta name="description" content="Trình tạo mã QR miễn phí của Ruby Wings Travel. Tạo mã QR cho website, fanpage, menu 4Tea, và hỗ trợ từ thiện Viện Nhi TW Huế.">
  <meta name="keywords" content="tạo mã qr miễn phí, trình tạo qr code, mã qr menu, qr từ thiện, ruby wings travel, menu 4tea, công cụ qr code, generator qr">
  <meta name="author" content="Ruby Wings Travel">
  <meta name="robots" content="index, follow">

  <!-- Open Graph Đầy Đủ -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://rubywings.vn/QR-menu.html">
  <meta property="og:title" content="QR Menu Generator | Trình Tạo Mã QR Miễn Phí - Ruby Wings Travel">
  <meta property="og:description" content="Công cụ tạo mã QR miễn phí cho website, menu, fanpage và hỗ trợ từ thiện Viện Nhi TW Huế.">
  <meta property="og:image" content="https://rubywings.vn/images/QR-menu.jpg">
  <meta property="og:site_name" content="Ruby Wings Travel">
  <meta property="og:locale" content="vi_VN">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://rubywings.vn/QR-menu.html">
  <meta name="twitter:title" content="QR Menu Generator | Trình Tạo Mã QR Miễn Phí">
  <meta name="twitter:description" content="Tạo mã QR miễn phí cho menu 4Tea, website và từ thiện.">
  <meta name="twitter:image" content="https://rubywings.vn/images/QR-menu.jpg">
  <meta name="twitter:creator" content="@TienSy379">
  <script src="facebook-pixel-complete.js"></script>
  <!-- Canonical -->
  <link rel="canonical" href="https://rubywings.vn/QR-menu.html">

  <!-- Favicon -->
  <link rel="icon" href="https://rubywings.vn/favicon.ico" type="image/x-icon">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">

  <!-- Schema.org JSON-LD Chi Tiết -->
 <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://rubywings.vn/#organization",
      "name": "Ruby Wings Travel",
      "url": "https://rubywings.vn/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://rubywings.vn/images/logo.png"
      },
      "description": "Du lịch trải nghiệm - Hành trình của chiều sâu",
      "telephone": "+84-33-251-0486",
      "email": "rubywingslsa@gmail.com",
      "sameAs": [
        "https://www.facebook.com/profile.php?id=61563772112138",
        "https://www.facebook.com/tien.sy.5011/",
        "https://x.com/TienSy379",
        "https://www.instagram.com/tiensyrubywings",
        "https://www.tiktok.com/@syluong379",
        "https://www.linkedin.com/in/ti%E1%BA%BFn-s%E1%BB%B9-l%C6%B0%C6%A1ng-9a0292387"
      ],
      "founder": {
        "@type": "Person",
        "name": "Lương Tiến Sỹ",
        "jobTitle": "Founder & CEO",
        "url": "https://www.facebook.com/tien.sy.5011/"
      }
    },
    {
      "@type": "WebApplication",
      "@id": "https://rubywings.vn/QR-menu.html#webapp",
      "name": "QR Menu Generator - Ruby Wings Travel",
      "description": "Công cụ tạo mã QR miễn phí cho website, menu và các mục đích cộng đồng.",
      "url": "https://rubywings.vn/QR-menu.html",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript",
      "creator": {
        "@id": "https://rubywings.vn/#organization"
      },
      "offers": {
        "@type": "Offer",
        "availability": "https://schema.org/InStock"
      },
      "featureList": [
        "Tạo QR code cho website",
        "Tạo QR code cho Fanpage Facebook",
        "Tạo QR code menu nhà hàng",
        "Tạo QR code cho mục đích cộng đồng",
        "Tùy chỉnh màu sắc QR code",
        "Tải QR code chất lượng cao"
      ]
    },
    {
      "@type": "FoodEstablishment",
      "name": "4Tea",
      "description": "Quán trà 4Tea - Đặt món qua QR code",
      "telephone": "+84-91-508-3357",
      "servesCuisine": "Trà và đồ uống",
      "hasMenu": "https://rubywings.vn/QR-menu.html",
      "url": "https://rubywings.vn/QR-menu.html"
    },
    {
      "@type": "WebPage",
      "@id": "https://rubywings.vn/QR-menu.html#webpage",
      "url": "https://rubywings.vn/QR-menu.html",
      "name": "QR Menu Generator | Ruby Wings Travel",
      "description": "Trang tạo mã QR miễn phí cho menu và các mục đích cộng đồng.",
      "isPartOf": {
        "@id": "https://rubywings.vn/#website"
      },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "https://rubywings.vn/images/QR-menu.jpg"
      },
      "mainEntity": {
        "@id": "https://rubywings.vn/QR-menu.html#webapp"
      },
      "publisher": {
        "@id": "https://rubywings.vn/#organization"
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Trang chủ",
          "item": "https://rubywings.vn/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Công cụ",
          "item": "https://rubywings.vn/cong-cu.html"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "QR Menu Generator",
          "item": "https://rubywings.vn/QR-menu.html"
        }
      ]
    },
    {
      "@type": "WebSite",
      "@id": "https://rubywings.vn/#website",
      "url": "https://rubywings.vn/",
      "name": "Ruby Wings Travel",
      "description": "Du lịch trải nghiệm - Hành trình của chiều sâu",
      "publisher": {
        "@id": "https://rubywings.vn/#organization"
      }
    }
  ]
}
</script>


  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BD5GXRQFQZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config','G-BD5GXRQFQZ');
  </script>

  <!-- Inline CSS Tối Ưu Tốc Độ -->
  <style>
    /* Theme variables */
    :root{
      --primary-pink: #FF4081;
      --primary-pink-2: #ff1493;
      --brand-green: #28a745;
      --accent-yellow: #e9c46a;
      --dark-blue: #264653;
      --muted: #666666;
      --bg: #ffffff;
      --glass: rgba(255,255,255,0.94);
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.06);
      --shadow-strong: 0 20px 50px rgba(40,167,69,0.08);
      --transition: 240ms cubic-bezier(.2,.9,.2,1);
      --maxw: 1200px;
      --system-font: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      --golden-brown: #DAA520; /* Màu nâu vàng cho footer */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--system-font);
      background:var(--bg);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.5;
      -webkit-tap-highlight-color: transparent;
      text-align: justify; /* Căn đều văn bản */
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto;display:block}

    .container{
      width:100%;
      max-width:var(--maxw);
      margin:0 auto;
      padding:0 16px;
    }

    /* Header */
    header{
      position:sticky;top:0;z-index:1400;
      background:rgba(255,255,255,0.96);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow-soft);
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }
    .header-inner{
      max-width:var(--maxw);
      margin:0 auto;
      padding:10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .logo{display:flex;align-items:center;gap:12px}
    .logo img{height:56px;width:auto;border-radius:8px;object-fit:contain}
    .logo-title{display:flex;flex-direction:column;line-height:1}
    .logo-main{font-weight:700;color:var(--primary-pink);font-size:1rem;letter-spacing:0.6px}
    .logo-sub{font-size:0.82rem;color:var(--brand-green);font-weight:600}

    .desktop-nav{display:none;gap:18px}
    .desktop-nav a{font-weight:600;padding:8px 6px;position:relative}
    .desktop-nav a::after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:var(--primary-pink);transform:scaleX(0);transform-origin:left;transition:transform 160ms}
    .desktop-nav a:hover::after{transform:scaleX(1)}

    .nav-toggle{
      background:none;border:0;padding:8px;border-radius:10px;color:var(--primary-pink);font-size:18px;
      display:flex;align-items:center;gap:8px;cursor:pointer;
    }
    nav.site-nav{
      position:fixed;left:0;right:0;bottom:0;transform:translateY(102%);
      background:linear-gradient(180deg,#fff,#fbfbfb);
      box-shadow:0 -12px 30px rgba(0,0,0,0.06);
      border-top-left-radius:14px;border-top-right-radius:14px;
      padding:14px 16px;transition:transform var(--transition);
      z-index:1300;
    }
    nav.site-nav.open{transform:translateY(0)}
    nav.site-nav .links{display:flex;flex-direction:column;gap:10px}
    nav.site-nav a{display:block;padding:12px;border-radius:10px;font-weight:700;color:var(--dark-blue)}

    /* Hero - centered */
    main{padding:18px 0 100px}
    .hero{
      text-align:center;
      background: linear-gradient(135deg, #e8f5e8 0%, #f7fff7 60%);
      border-radius:var(--radius-lg);
      padding:18px;
      box-shadow:var(--shadow-soft);
      border:1px solid rgba(40,167,69,0.06);
    }
    .hero h1{
      margin:0;
      font-size:1.1rem;
      color:var(--brand-green);
      font-weight:800;
      letter-spacing:0.2px;
      display:inline-block;
      line-height:1.05;
    }
    .hero p.lead{
      margin:12px auto 0;
      max-width:820px;
      color:var(--muted);
      font-weight:600;
      background:rgba(255,255,255,0.9);
      padding:12px 14px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.04);
      font-size:0.98rem;
      line-height:1.45;
    }
    .hero .underline{
      height:6px;width:140px;margin:14px auto 0;border-radius:4px;
      background:linear-gradient(90deg,var(--brand-green),var(--primary-pink),var(--brand-green));
      box-shadow:0 8px 26px rgba(0,0,0,0.04);
    }

    /* Layout grid: menu first */
    .stack{margin-top:16px;display:grid;gap:14px}
    .card{
      background:var(--glass);
      border-radius:12px;
      padding:14px;
      box-shadow:var(--shadow-soft);
      border:1px solid rgba(0,0,0,0.03);
      transition:transform var(--transition),box-shadow var(--transition);
      overflow:hidden;
    }

    /* Menu card */
    .menu-card .title{display:flex;align-items:center;gap:10px;justify-content:center;font-weight:800;color:var(--brand-green)}
    .menu-card .phone{font-weight:800;color:var(--brand-green);font-size:1.1rem;margin-top:8px;text-align:center}
    .menu-card .invite{font-weight:700;color:var(--primary-pink);text-align:center;margin-top:6px}
    .menu-image{border-radius:10px;overflow:hidden;display:block}
    .menu-image img{width:100%;height:auto;display:block;border-radius:10px;object-fit:cover}

    /* QR generator */
    .section-title{display:flex;align-items:center;gap:10px;justify-content:center;color:var(--brand-green);font-weight:800}
    .input-group{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .input-label{font-weight:700;color:var(--brand-green);display:flex;align-items:center;gap:8px}
    .input{
      width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e7e7e7;background:#fff;font-size:15px;
      outline:none;transition:box-shadow var(--transition),border-color var(--transition);
    }
    .input:focus{border-color:var(--brand-green);box-shadow:0 8px 26px rgba(40,167,69,0.08)}
    .btn{
      display:inline-flex;align-items:center;gap:10px;justify-content:center;
      background:linear-gradient(135deg,var(--brand-green),#20c997);color:#fff;border-radius:12px;padding:12px 14px;border:0;font-weight:800;width:100%;
      cursor:pointer;transition:transform var(--transition),box-shadow var(--transition);
      text-transform:uppercase;letter-spacing:0.7px;font-size:0.95rem;
    }
    .btn.secondary{background:linear-gradient(135deg,var(--primary-pink),var(--primary-pink-2))}
    .qr-display{
      min-height:220px;border-radius:12px;border:2px dashed #eee;display:flex;align-items:center;justify-content:center;margin-top:12px;
      background: linear-gradient(180deg, rgba(248,249,250,0.95), rgba(255,255,255,0.97));
    }
    .qr-placeholder{color:#9aa;display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center;padding:16px}
    .qr-placeholder i{font-size:44px;color:var(--brand-green);opacity:0.9}

    .msg{padding:10px;border-radius:10px;text-align:center;margin-top:10px;display:none}
    .msg.success{background:#dff3e6;color:#1f6b36;border-left:4px solid var(--brand-green)}
    .msg.error{background:#ffe8e8;color:#8b1e2a;border-left:4px solid #e53e3e}

    .charity{display:flex;gap:12px;align-items:center;margin-top:12px;padding:10px;border-radius:12px;background:linear-gradient(90deg,#fff5f8,#fff0f5);border:1px solid rgba(255,105,180,0.08)}
    .charity .thumb{width:92px;flex-shrink:0;border-radius:8px;overflow:hidden}
    .charity h3{margin:0;color:var(--primary-pink);font-size:1rem}
    .charity p{margin:0;color:var(--muted);font-size:0.94rem;line-height:1.4}

    /* Footer */
    footer{background:linear-gradient(135deg,var(--dark-blue),var(--brand-green));color:#fff;padding:26px 0;margin-top:26px}
    .footer-content{display:grid;grid-template-columns:1fr;gap:14px}
    
    /* Đổi màu tiêu đề footer thành nâu vàng */
    .footer-column h3 {
      color: var(--golden-brown) !important;
      margin: 0 0 8px 0;
    }
    
    /* Biểu tượng MXH hiển thị 1 hàng ngang */
    .social-links-grid {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 8px;
      margin-top: 15px;
      padding-bottom: 5px;
      -webkit-overflow-scrolling: touch;
    }
    
    .social-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: white !important;
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    /* Màu sắc thương hiệu cho từng nền tảng */
    .social-icon.facebook {
      background-color: #3b5998;
    }
    .social-icon.facebook-personal {
      background-color: #1877f2;
    }
    .social-icon.twitter {
      background-color: #1da1f2;
    }
    .social-icon.instagram {
      background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
    }
    .social-icon.tiktok {
      background-color: #000000;
    }
    .social-icon.linkedin {
      background-color: #0077b5;
    }
    .social-icon.whatsapp {
      background-color: #25D366;
    }
    .social-icon.zalo {
      background-color: #0068FF;
      padding: 5px;
    }
    .social-icon.youtube {
      background-color: #FF0000;
    }
    .social-icon.messenger {
      background: linear-gradient(135deg, #0084FF 0%, #00C6FF 100%);
    }
    .zalo-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .copyright{font-size:0.92rem;text-align:center;opacity:0.95;margin-top:6px}

    /* Link tiêu đề "Về chúng tôi" */
    .footer-title-link {
      color: inherit;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    /* Nút tham gia cộng đồng */
    .community-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #e91e63;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Responsive */
    @media(min-width:720px){
      .desktop-nav{display:flex}
      nav.site-nav{display:none}
      .nav-toggle{display:none}

      main{padding:22px 0 120px}
      .stack{grid-template-columns:1fr 420px;gap:18px}
      .card{padding:16px}
      .hero h1{font-size:1.25rem}
      .footer-content{grid-template-columns:repeat(3,1fr)}
      .social-links-grid {
        overflow-x: visible;
        flex-wrap: wrap;
        justify-content: flex-start;
      }
    }
    @media(min-width:980px){
      .container{padding:0 18px}
      .stack{grid-template-columns:1fr 420px;gap:22px}
      .hero{padding:22px}
      .qr-display{min-height:260px}
      footer{padding:36px 0}
    }
    @media(min-width:1200px){
      .container{max-width:1200px}
    }

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="header-inner container" role="banner">
      <div class="logo">
        <img src="assets/images/ruby-wings-logo.png" alt="Ruby Wings Travel Logo - Du lịch trải nghiệm" onerror="this.style.opacity=0.7">
        <div class="logo-title">
          <div class="logo-main">RUBY WINGS</div>
          <div class="logo-sub">Travel - Hành trình trải nghiệm</div>
        </div>
      </div>

      <nav class="desktop-nav" aria-label="Primary">
        <a href="index.html">Trang chủ</a>
        <a href="tuyen-ngon-sang-lap-ruby-wings.html">Về Ruby Wings chúng tôi</a>
        <a href="ve-dep-quang-tri.html">Khám phá Miền Trung ruột</a>
        <a href="nhung-hanh-trinh-tieu-bieu.html">Hành trình tiêu biểu</a>
        <a href="ve-dep-thien-nhien-viet-nam.html">Non nước- Việt Nam</a>
        <a href="thien-va-suc-khoe.html">Retreat- Chữa lành</a>
      </nav>

      <button class="nav-toggle" id="mobileMenuBtn" aria-expanded="false" aria-controls="mobileNav">
        <i class="fas fa-bars" aria-hidden="true"></i><span class="sr-only">Mở menu</span>
      </button>
    </div>

    <!-- Mobile sheet nav -->
    <nav id="mobileNav" class="site-nav" aria-hidden="true">
      <div class="links container" role="navigation">
        <a href="index.html">Trang chủ</a>
        <a href="tuyen-ngon-sang-lap-ruby-wings.html">Về chúng tôi</a>
        <a href="ve-dep-thien-nhien-viet-nam.html">Thiên nhiên</a>
        <a href="danh-muc-cac-hanh-trinh-dac-biet.html">Hành trình</a>
        <a href="non-nuoc-viet-nam.html">Non nước Việt Nam</a>
        <a href="Hanh-trinh-trai-nghiem-cam-xuc-2.html">Trải nghiệm</a>
        <a href="#lien-he">Liên hệ</a>
      </div>
    </nav>
  </header>

  <!-- Main -->
  <main class="container" role="main">
    <!-- HERO (centered) -->
    <section class="hero" aria-labelledby="heroTitle">
      <h1 id="heroTitle"><i class="fas fa-qrcode" style="color:var(--primary-pink);margin-right:8px"></i>Trình Tạo Mã QR Vĩnh Viễn Miễn Phí</h1>
      <div class="underline" aria-hidden="true"></div>
      <p class="lead">
        <i class="fas fa-link" style="color:var(--brand-green);margin-right:8px"></i>
        <strong>Mã QR để kết nối tức thì thế giới thực với không gian online — dẫn khách đến website, fanpage, video giới thiệu...</strong>
      </p>
    </section>

    <!-- Stack: Menu first, then QR -->
    <section class="stack container" aria-label="Nội dung chính">
      <!-- MENU card -->
      <article class="card menu-card" aria-labelledby="menuTitle">
        <div id="menuTitle" class="title"><i class="fas fa-utensils" style="color:var(--primary-pink);"></i> Menu 4Tea</div>
        <div class="phone"><i class="fas fa-phone" style="color:var(--primary-pink);margin-right:8px"></i>0915083357</div>
        <div class="invite"><i class="fas fa-hand-point-right" style="color:var(--brand-green);margin-right:6px"></i>Mời bạn chọn món</div>

        <div style="margin-top:12px" class="menu-image">
          <img src="images/me-nu-4tea.jpg" alt="Menu 4Tea - Quán trà 4Tea với các loại đồ uống đa dạng" loading="lazy">
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:0.95rem">
          <p>Dùng 2 ngón để phóng to. Có thể gọi đặt món qua số điện thoại.</p>
        </div>
      </article>

      <!-- QR generator card -->
      <article class="card" aria-labelledby="qrTitle">
        <div id="qrTitle" class="section-title"><i class="fas fa-mobile-alt" style="color:var(--primary-pink)"></i> Tạo Mã QR Của Bạn</div>

        <div class="input-group">
          <label class="input-label" for="url-input"><i class="fas fa-globe" style="color:var(--primary-pink)"></i> Nhập địa chỉ web:</label>
          <input id="url-input" class="input" type="text" placeholder="https://vi-example.com" inputmode="url" autocomplete="url" />
        </div>

        <button id="generateBtn" class="btn" aria-controls="qrcode"><i class="fas fa-cog"></i> Tạo Mã QR</button>

        <div id="qrcode" class="qr-display" role="region" aria-live="polite" aria-label="Mã QR">
          <div class="qr-placeholder">
            <i class="fas fa-qrcode" aria-hidden="true"></i>
            <div>Mã QR sẽ xuất hiện ở đây</div>
            <div style="font-size:0.9rem;color:var(--muted);margin-top:6px">Hỗ trợ lâu dài nếu URL không thay đổi</div>
          </div>
        </div>

        <div id="error-message" class="msg error" role="alert" aria-hidden="true"></div>
        <div id="success-message" class="msg success" role="status" aria-hidden="true"></div>

        <button id="download-btn" class="btn secondary" style="display:none;margin-top:10px"><i class="fas fa-download"></i> Tải Mã QR Về Máy</button>

        <div class="charity" aria-label="Hoạt động từ thiện" style="margin-top:14px">
          <div class="thumb"><img src="images/QR-tu-thien.jpg" alt="QR Code từ thiện - Ủng hộ các cháu bệnh nhi tại Viện Nhi TW Huế"></div>
          <div>
            <h3><i class="fas fa-heart" style="color:var(--primary-pink);margin-right:6px"></i> Hoạt động Trao yêu thương</h3>
            <p> Chúng tôi khuyến khích khi tạo 1 mã QR bằng cách nào đó Bạn gửi đến từ thiện khoảng 5-10.000vnđ  — bạn có thể bỏ qua nếu không muốn vẫn dùng được QR như bình thường.</p>

          </div>
        </div>
      </article>
    </section>

    <div style="text-align:center;margin-top:18px">
      <a href="nhung-hanh-trinh-tieu-bieu.html" class="btn secondary" style="display:inline-flex;align-items:center;gap:10px;max-width:720px">
        <i class="fas fa-heart"></i> Khám phá hành trình trải nghiệm <i class="fas fa-arrow-right"></i>
      </a>
    </div>
  </main>
<style>
/* === RUBY WINGS CONSULTATION BUTTON - MOBILE GREEN VERSION === */
.rw-consult-btn-container {
    display: block !important;
    margin: 25px 0 !important;
    text-align: center !important;
    width: 100% !important;
}

.rw-consult-btn-main {
    /* Reset mọi style mặc định */
    all: unset !important;
    
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    text-decoration: none !important;
    
    /* Kích thước và khoảng cách */
    padding: 18px 35px !important;
    margin: 10px auto !important;
    
    /* Kiểu dáng */
    border-radius: 50px !important;
    border: 3px solid #2cec2c !important;
    font-weight: 800 !important;
    font-size: 18px !important;
    line-height: 1.3 !important;
    text-align: center !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    
    /* Màu sắc - XANH LÁ CÂY + CHỮ VÀNG */
    background: linear-gradient(135deg, #2cec2c 0%, #22cc22 100%) !important;
    color: #ffd700 !important;
    cursor: pointer !important;
    
    /* Hiệu ứng */
    transition: all 0.4s ease !important;
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 0 6px 20px rgba(44, 236, 44, 0.3) !important;
    
    /* Font chữ rõ ràng */
    font-family: 'Arial', 'Helvetica', sans-serif !important;
}

/* TEXT - CHỮ MÀU VÀNG NỔI BẬT */
.rw-consult-btn-main .rw-btn-text {
    color: #f3f5f8 !important;
    font-weight: 800 !important;
    font-size: 18px !important;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;
    z-index: 2 !important;
    position: relative !important;
}

/* === HIỆU ỨNG HOVER - CHUYỂN MÀU ĐẬM DẦN === */
.rw-consult-btn-main:hover {
    transform: translateY(-4px) scale(1.05) !important;
    box-shadow: 0 12px 30px rgba(44, 236, 44, 0.5) !important;
    background: linear-gradient(135deg, #32ff32 0%, #1a991a 100%) !important;
    border-color: #32ff32 !important;
    color: #ffd700 !important;
}

.rw-consult-btn-main:hover .rw-btn-text {
    color: #ffd700 !important;
}

/* Hiệu ứng ánh sáng trượt */
.rw-consult-btn-main::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: -100% !important;
    width: 100% !important;
    height: 100% !important;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent) !important;
    transition: left 0.7s ease !important;
    z-index: 1 !important;
}

.rw-consult-btn-main:hover::before {
    left: 100% !important;
}

/* === MOBILE RESPONSIVE - 1 DÒNG & TỐI ƯU === */
@media (max-width: 768px) {
    .rw-consult-btn-main {
        padding: 16px 25px !important;
        font-size: 16px !important;
        width: 95% !important;
        max-width: 320px !important;
        display: flex !important; /* Đảm bảo 1 dòng */
        flex-wrap: nowrap !important;
        white-space: nowrap !important;
    }
    
    .rw-consult-btn-main .rw-btn-text {
        font-size: 16px !important;
        white-space: nowrap !important;
        /* BỎ MŨI TÊN - chỉ hiển thị text */
    }
    
    /* Ẩn hoàn toàn mũi tên trên mobile */
    .rw-consult-btn-main .rw-btn-arrow {
        display: none !important;
    }
    
    /* Màu mobile - xanh lá nhạt */
    .rw-consult-btn-main {
        background: linear-gradient(135deg, #2bdc2b 0%, #1a9f1a 100%) !important;
        border-color: #2cec2c !important;
    }
}

@media (max-width: 480px) {
    .rw-consult-btn-main {
        padding: 14px 20px !important;
        font-size: 15px !important;
        margin: 8px auto !important;
    }
    
    .rw-consult-btn-main .rw-btn-text {
        font-size: 15px !important;
        letter-spacing: 0.5px !important;
    }
}

/* Desktop - vẫn giữ mũi tên */
@media (min-width: 769px) {
    .rw-consult-btn-main .rw-btn-arrow {
        margin-left: 12px !important;
        transition: transform 0.3s ease !important;
        font-weight: bold !important;
        font-size: 18px !important;
        color: #fff3af !important;
        z-index: 2 !important;
        position: relative !important;
    }
    
    .rw-consult-btn-main:hover .rw-btn-arrow {
        transform: translateX(4px) !important;
    }
}

/* Đảm bảo không bị ảnh hưởng bởi CSS khác */
.rw-consult-btn-container * {
    box-sizing: border-box !important;
}
</style>

<!-- === HTML CHÈN VÀO TRANG === -->
<div class="rw-consult-btn-container">
    <a href="https://forms.gle/XCWf6zgFRp4Vhbw39" 
       class="rw-consult-btn-main" 
       target="_blank"
       rel="noopener noreferrer"
       onclick="trackConsultationClick()">
        <span class="rw-btn-text">ĐĂNG KÝ THÔNG TIN TƯ VẤN</span>
        <span class="rw-btn-arrow">→</span>
    </a>
</div>

<script>
// === JAVASCRIPT HOÀN CHỈNH VỚI FACEBOOK PIXEL ===
function trackConsultationClick() {
    // === FACEBOOK PIXEL TRACKING - QUAN TRỌNG ===
    if (typeof fbq !== 'undefined') {
        fbq('track', 'Lead', {
            content_name: 'Đăng ký tư vấn chung - ' + document.title,
            content_category: 'General Consultation',
            page_url: window.location.href,
            button_type: 'General CTA'
        });
        console.log('Facebook Pixel: Tracked consultation click');
    } else {
        console.warn('Facebook Pixel not loaded yet');
    }
    
    // === GOOGLE ANALYTICS TRACKING (GIỮ NGUYÊN) ===
    if (typeof gtag !== 'undefined') {
        gtag('event', 'consultation_click', {
            'event_category': 'engagement',
            'event_label': 'Google Forms Consultation Button'
        });
    }
    
    console.log('Consultation button clicked - Opening: https://forms.gle/XCWf6zgFRp4Vhbw39');
    
    // === ĐẢM BẢO MỞ FORM SAU KHI TRACKING ===
    setTimeout(function() {
        window.open('https://forms.gle/XCWf6zgFRp4Vhbw39', '_blank');
    }, 100);
}

// === HIỆU ỨNG VÀ XỬ LÝ BUTTON ===
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.querySelector('.rw-consult-btn-main');
    if (btn) {
        console.log('Ruby Wings Consultation Button loaded successfully');
        
        // Thêm hiệu ứng click
        btn.addEventListener('mousedown', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });
        
        btn.addEventListener('mouseup', function() {
            this.style.transform = 'translateY(-4px) scale(1.05)';
        });
        
        // Xử lý sự kiện click để đảm bảo tracking
        btn.addEventListener('click', function(e) {
            // Ngăn mở link ngay lập tức
            e.preventDefault();
            // Gọi hàm tracking
            trackConsultationClick();
        });
        
        // Kiểm tra mobile
        if (window.innerWidth <= 768) {
            console.log('Mobile mode: Green background, no arrow, single line');
        }
    }
});

// === BACKUP TRACKING - NẾU PIXEL CHƯA LOAD ===
function ensurePixelTracking() {
    if (typeof fbq === 'undefined') {
        console.log('Waiting for Facebook Pixel to load...');
        setTimeout(ensurePixelTracking, 500);
    }
}

// Khởi động backup tracking
ensurePixelTracking();
</script>
 <!-- Footer -->
<footer id="contact">
    <div class="container">
        <div class="footer-content">
            <div class="footer-column">
                <h3><a href="tuyen-ngon-sang-lap-ruby-wings.html" class="footer-title-link">Về chúng tôi</a></h3>
                <p>Ruby Wings Travel - "Nơi bạn không chỉ đến một nơi, mà còn có thể được trở về với chính mình".</p>
                <p> MST: 3301743759</p>
                <div class="social-links-grid">
                    <a href="https://www.facebook.com/profile.php?id=61563772112138" target="_blank" class="social-icon facebook" title="Facebook Fanpage">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.facebook.com/tien.sy.5011/" target="_blank" class="social-icon facebook-personal" title="Facebook Cá nhân">
                        <i class="fas fa-user"></i>
                    </a>
                    <a href="https://x.com/TienSy379/status/1971778015232421915?t=UsXdMD8FrwjF3OO3ZnoUGg&s=19" target="_blank" class="social-icon twitter" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.instagram.com/tiensyrubywings?igsh=MWV3czBwMmYwYnIydA==" target="_blank" class="social-icon instagram" title="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://www.tiktok.com/@syluong379?_t=ZS-904eIdTTG12&_r=1" target="_blank" class="social-icon tiktok" title="TikTok">
                        <i class="fab fa-tiktok"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/ti%E1%BA%BFn-s%E1%BB%B9-l%C6%B0%C6%A1ng-9a0292387?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank" class="social-icon linkedin" title="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://wa.me/84332510486" target="_blank" class="social-icon whatsapp" title="WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://zalo.me/84332510486" target="_blank" class="social-icon zalo" title="Zalo Nhắn tin">
                        <img src="images/zalo.jpg" alt="Zalo - Nhắn tin với Ruby Wings Travel" class="zalo-icon">
                    </a>
                    <a href="https://www.youtube.com/@rubywing-slsa" target="_blank" class="social-icon youtube" title="YouTube">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://m.me/tien.sy.5011?hash=AbY3ty4r4j7255Yb&source=qr_link_share" target="_blank" class="social-icon messenger" title="Messenger">
                        <i class="fab fa-facebook-messenger"></i>
                    </a>
                </div>
            </div>
            <div class="footer-column">
                <h3>Liên Hệ</h3>
                <div class="contact-info">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>148 Trương Gia Mô, Vỹ Dạ TP. Huế</span>
                </div>
                <div class="contact-info">
                    <i class="fas fa-phone"></i>
                    <span>0332510486 - 0915083357</span>
                </div>
                <div class="contact-info">
                    <i class="fab fa-whatsapp"></i>
                    <span>0332510486 (WhatsApp/Zalo)</span>
                </div>
                <div class="contact-info">
                    <i class="fas fa-envelope"></i>
                    <span><a href="mailto:rubywingslsa@gmail.com">rubywingslsa@gmail.com</a></span>
                </div>
            </div>
            <div class="footer-column">
                <h3>Tham gia cộng đồng</h3>
                <p>Tham gia nhóm cộng đồng Ruby Wings Travel để nhận những thông tin mới nhất, chia sẻ trải nghiệm và lan tỏa giá trị du lịch có trách nhiệm.</p>
                <a href="https://www.facebook.com/groups/4107197836205156/" target="_blank" class="community-btn">
                    Tham gia nhóm <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
     
    </div>
</footer>

<!-- Inline JS Tối Ưu Tốc Độ -->
<script>
  // Mobile menu toggle - ĐÃ SỬA LỖI HOÀN TOÀN
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    
    if (mobileMenuBtn && mobileNav) {
      mobileMenuBtn.addEventListener('click', function(event) {
        event.stopPropagation(); // Ngăn sự kiện lan ra ngoài
        
        const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
        mobileMenuBtn.setAttribute('aria-expanded', !isExpanded);
        mobileNav.classList.toggle('open');
        mobileNav.setAttribute('aria-hidden', isExpanded);
      });
      
      // Đóng menu khi click bên ngoài, nhưng không đóng khi click vào các phần tử form
      document.addEventListener('click', function(event) {
        // Kiểm tra xem click có phải vào các phần tử form không
        const isFormElement = event.target.matches('input, textarea, select, button, label');
        
        if (!mobileNav.contains(event.target) && 
            !mobileMenuBtn.contains(event.target) && 
            !isFormElement) {
          mobileNav.classList.remove('open');
          mobileMenuBtn.setAttribute('aria-expanded', 'false');
          mobileNav.setAttribute('aria-hidden', 'true');
        }
      });
      
      // Đóng menu khi click vào link trong menu mobile
      const mobileLinks = mobileNav.querySelectorAll('a');
      mobileLinks.forEach(link => {
        link.addEventListener('click', function() {
          mobileNav.classList.remove('open');
          mobileMenuBtn.setAttribute('aria-expanded', 'false');
          mobileNav.setAttribute('aria-hidden', 'true');
        });
      });
    }
    
    // QR Code Generator
    const generateBtn = document.getElementById('generateBtn');
    const urlInput = document.getElementById('url-input');
    const qrDisplay = document.getElementById('qrcode');
    const downloadBtn = document.getElementById('download-btn');
    const errorMsg = document.getElementById('error-message');
    const successMsg = document.getElementById('success-message');
    
    if (generateBtn) {
      generateBtn.addEventListener('click', function() {
        const url = urlInput.value.trim();
        
        // Reset messages
        errorMsg.style.display = 'none';
        successMsg.style.display = 'none';
        
        // Validate URL
        if (!url) {
          showError('Vui lòng nhập địa chỉ web');
          return;
        }
        
        // Basic URL validation
        try {
          new URL(url);
        } catch (e) {
          showError('Địa chỉ web không hợp lệ. Vui lòng nhập URL đầy đủ (bao gồm http:// hoặc https://)');
          return;
        }
        
        // Generate QR code
        generateQRCode(url);
      });
    }
    
    function showError(message) {
      errorMsg.textContent = message;
      errorMsg.style.display = 'block';
      errorMsg.setAttribute('aria-hidden', 'false');
    }
    
    function showSuccess(message) {
      successMsg.textContent = message;
      successMsg.style.display = 'block';
      successMsg.setAttribute('aria-hidden', 'false');
    }
    
    function generateQRCode(url) {
      // Clear previous QR code
      qrDisplay.innerHTML = '';
      
      // Create QR code using simple API (you can replace with a library if needed)
      const qrImg = document.createElement('img');
      qrImg.alt = `Mã QR cho địa chỉ: ${url}`;
      qrImg.style.maxWidth = '200px';
      qrImg.style.maxHeight = '200px';
      
      // Using a free QR code API
     qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}&format=png&bgcolor=ffffff&color=000000&qzone=1`;
      
      qrImg.onload = function() {
        qrDisplay.appendChild(qrImg);
        downloadBtn.style.display = 'inline-flex';
        showSuccess('Mã QR đã được tạo thành công!');
        
        // Set up download functionality
        downloadBtn.onclick = function() {
          const link = document.createElement('a');
          link.download = 'qrcode.png';
          link.href = qrImg.src;
          link.click();
        };
      };
      
      qrImg.onerror = function() {
        showError('Có lỗi xảy ra khi tạo mã QR. Vui lòng thử lại.');
      };
    }
    
    // Header scroll behavior
    let lastScrollTop = 0;
    const header = document.querySelector('header');
    const scrollThreshold = 100;
    
    window.addEventListener('scroll', function() {
      let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
        header.classList.add('hidden');
      } else {
        header.classList.remove('hidden');
      }
      
      lastScrollTop = scrollTop;
    });
  });
</script>

<!-- RUBY WINGS – META PIXEL LOGIC + CONSULT BUTTON (FINAL, FIX MAP, FIX DEEPSCROLL, NO FALLBACK) -->
<script>
(function(){
'use strict';

/* =========================================================
   CONFIG
========================================================= */
const SCROLL_DEPTH = 80;
const ENGAGED_TIME = 30000;

/* =========================================================
   CONTENT ID MAP (ÉP MAP – KHÔNG AUTO)
========================================================= */
const CONTENT_ID_MAP = {
  '': 'RW_HOME',
  'nhung-hanh-trinh-tieu-bieu': 'RW_LANDING_FEATURED',
  'nhung-hanh-trinh-tham-quan-trai-nghiem-linh-hoat': 'RW_LANDING_FLEX',
  'ngon-lua-truong-son-2n1d': 'RW_TOUR_NLTSON_2N1D',
  'mua-do-va-tay-truong-son-2n1d': 'RW_TOUR_MUADO_TSON_2N1D',
  'hanh-trinh-lanh-dao-3n2d': 'RW_TOUR_LANHDAO_3N2D',
  'di-san-quoc-gia-2n1d': 'RW_TOUR_DISANQG_2N1D',
  'huyen-thoai-nguoi-phu-nu-viet-nam-3n2d': 'RW_TOUR_PHUNUVN_3N2D',
  'dmz-hoa-giai-ban-sac-4n3d': 'RW_TOUR_DMZ_4N3D',
  'dmz-tham-chien-truong-xua-va-dong-doi': 'RW_TOUR_DMZ_THAMCHIENTRUONG_3N2D',
  'hanh-trinh-trai-nghiem-linh-hoat': 'RW_FLEX_GENERAL',
  'hanh-trinh-giao-duc-ky-nang-song': 'RW_FLEX_EDU_SKILL',
  'hanh-trinh-trai-nghiem-thien-nhien': 'RW_FLEX_NATURE',
  'hanh-trinh-van-hoa-di-san': 'RW_FLEX_HERITAGE',
  'tom_tat_ho_so_hanh_trinh_mau_cho_nha_truong': 'RW_PROFILE_SCHOOL',
  '01-mo-dau-ruby-wings-la-ai': 'RW_ABOUT_01',
  '02-cau-chuyen-khoi-nguon': 'RW_ABOUT_02',
  '03-triet-ly-gia-tri': 'RW_ABOUT_03',
  '04-logo-y-nghia': 'RW_ABOUT_04',
  '05-he-sinh-thai-ruby-wings': 'RW_ABOUT_05',
  'dich-vu-du-lich-trai-nghiem': 'RW_SERVICE_EXPERIENCE',
  'dich-vu-retreat-chua-lanh': 'RW_SERVICE_RETREAT',
  'dich-vu-team-building': 'RW_SERVICE_TEAMBUILDING',
  'dich-vu-giao-duc-ky-nang': 'RW_SERVICE_EDUCATION',
  'lien-he': 'RW_CONTACT',
  'gioi-thieu': 'RW_ABOUT',
  'theo_dong_di_san_mien_trung_tu_pho_co_den_co_do': 'RW_TOUR_DISANMIENTRUNG_3N2D',
  'ky_uc_va_dai_ngan_tinh_lang_gv': 'RW_TOUR_KYUC_DAINGAN_2N1D',
  'mien_trung_di_san_kham_pha_quy_nhon_phu_yen': 'RW_TOUR_QUYNHON_PHUYEN_4N3D',
  'kham_pha_dat_viet_van_hoa_ky_quan_thien_nhien_khe_sanh_tam_dao_moc_chau': 'RW_TOUR_TAMDAO_MOCCHAU_4N3D',
  'mien_bac_di_san_tam_linh_thien_nhien': 'RW_TOUR_HALONG_NINHBINH_TAMCHUC_3N2D',
  'trai_nghiem_tinh_hoa_bac_bo_ha_noi_sa_pa_phu_tho': 'RW_TOUR_HANOI_SAPA_PHUTHO_5N4D',
  'di_san_kham_pha_ninh_binh_tam_dao_ha_long': 'RW_TOUR_NINHBINH_TAMDAO_HALONG_6N5D',
  'kham_pha_da_nang_hoi_an': 'RW_TOUR_DANANG_HOIAN_2N1D',
  'gioi_thieu_tai_lieu_bat_mach_noi_dau': 'RW_BOOK_BAT_MACH_NOI_DAU',
  'cong_dong_ban_sac_trong_nuoc': 'CONG_DONG_BAN_SAC_TRONG_NUOC',
  'ket_noi_trong_nuoc': 'KET_NOI_TRONG_NUOC',
  'lan_toa_trong_nuoc': 'LAN_TOA_TRONG_NUOC',
  'giao_duc_ky_nang_trong_nuoc': 'GIAO_DUC_KY_NANG_TRONG_NUOC',
  'trai-nghiem-linh-hoat-phu-nu': 'RW_TOUR_DONGCHAYYEUTHUONG_2N1D',
  'mua_do_va_tay_truong_son': 'RW_TOUR_MUADO_TSON_2N1D',
  'dai_ngan_truong_son_sac_xuan_mien_bien_vien': 'RW_TOUR_TRUONGSON_BIENVIEN_2N1D',
  'non-nuoc-bach-ma': 'RW_TOUR_BACHMA_1DAY',
  'sac_xuan_mien_bien_vien': 'RW_TOUR_SACXUAN_BIENVIEN_2N1D'
};

/* =========================================================
   LEAD KEYWORDS
========================================================= */
const LEAD_KEYWORDS = [
  'đăng ký',
  'đăng ký thông tin tư vấn',
  'gọi để chúng tôi tư vấn',
  'liên hệ đặt hành trình',
  'nơi nhận tư vấn',
  'nơi nhận tư vấn →',
  'liên hệ',
  'tư vấn',
  '033.251.0486'
];

/* =========================================================
   PATH KEY – FIX CHUẨN HTML TĨNH
========================================================= */
let pathKey = location.pathname
  .replace(/^\/|\/$/g,'')
  .replace('index.html','')
  .replace('.html','');

if(pathKey === '') pathKey = '';

const CONTENT_ID = CONTENT_ID_MAP[pathKey] || null;
const PAGE_TYPE = pathKey === '' ? 'home' : (CONTENT_ID ? 'page' : 'unmapped');

/* =========================================================
   VIEW CONTENT
========================================================= */
setTimeout(function(){
  if(!window.fbq || !CONTENT_ID) return;
  fbq('track','ViewContent',{
    content_name: document.title,
    content_category: PAGE_TYPE,
    content_ids: [CONTENT_ID],
    content_type: 'website',
    currency: 'VND',
    value: PAGE_TYPE==='home'?0:10000,
    predicted_ltv: PAGE_TYPE==='home'?0:1000000
  });
},1000);

/* =========================================================
   DEEP SCROLL (KHÔNG LỖI CHUỖI)
========================================================= */
let deepScrollSent=false;
window.addEventListener('scroll',function(){
  if(deepScrollSent || !window.fbq || !CONTENT_ID) return;
  const percent=(window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100;
  if(percent>=SCROLL_DEPTH){
    deepScrollSent=true;
    fbq('trackCustom','DeepScroll',{
      content_id: CONTENT_ID,
      page_type: PAGE_TYPE,
      scroll_depth: SCROLL_DEPTH
    });
  }
},{passive:true});

/* =========================================================
   ENGAGED VIEW
========================================================= */
setTimeout(function(){
  if(!window.fbq || !CONTENT_ID) return;
  fbq('trackCustom','EngagedView',{
    content_id: CONTENT_ID,
    page_type: PAGE_TYPE,
    time_on_page: ENGAGED_TIME/1000
  });
},ENGAGED_TIME);

/* =========================================================
   LEAD CLICK (CHẶN AUTO-DETECT)
========================================================= */
document.addEventListener('click',function(e){
  if(!window.fbq || !CONTENT_ID) return;
  const el=e.target.closest('a,button');
  if(!el) return;
  const text=(el.innerText||'').toLowerCase();
  const isLead=LEAD_KEYWORDS.some(k=>text.includes(k.toLowerCase()));
  if(!isLead) return;
  fbq('track','Lead',{
    _disable_auto_detect:true,
    content_name:text.substring(0,80),
    content_category:'consultation',
    content_ids:[CONTENT_ID],
    page_type:PAGE_TYPE,
    intent_level:'medium',
    value:180000,
    currency:'VND'
  });
});

/* =========================================================
   CONSULT BUTTON (GÓC PHẢI)
========================================================= */
const btn = document.createElement('div');
btn.innerHTML = `
 <a href="https://forms.gle/XCWf6zgFRp4Vhbw39"
   target="_blank"
   id="rw-consult-btn"
   style="
     position:fixed;
     right:20px;
     bottom:20px;
     z-index:9999;
     padding:12px 18px;
     background:linear-gradient(135deg,#16a34a,#22c55e);
     color:#ffffff;
     font-weight:700;
     font-size:14px;
     border-radius:30px;
     text-decoration:none;
     box-shadow:0 6px 16px rgba(0,0,0,.25);
   ">
   Form tư vấn
</a>
`;
document.body.appendChild(btn);

/* ===== META PIXEL: CONTACT (TRÌNH DUYỆT) ===== */
const contactBtn = document.getElementById('rw-consult-btn');
if (contactBtn && typeof fbq === 'function') {
  contactBtn.addEventListener('click', function () {
    fbq('track', 'Contact');
  });
}

})();
</script>



<script>
// Ruby Wings Chat Widget - Complete Isolation
const BACKEND_URL = "https://ruby-wings-chatbot.onrender.com";

(function() {
    'use strict';
    
    // Kiểm tra trùng lặp
    if (window.RW_CHAT_LOADED) return;
    window.RW_CHAT_LOADED = true;
    
    // Tạo container tách biệt hoàn toàn
    const createIsolatedWidget = function() {
        // Xóa widget cũ nếu có
        const oldWidgets = document.querySelectorAll('#rw-chat-isolated, .rw-chat-isolated');
        oldWidgets.forEach(w => w.remove());
        
        // Tạo container mới
        const container = document.createElement('div');
        container.id = 'rw-chat-isolated';
        container.className = 'rw-chat-isolated';
        
        // CSS hoàn toàn tách biệt
        const styles = `
            .rw-chat-isolated {
                position: fixed !important;
                left: 0 !important;
                bottom: 0 !important;
                width: auto !important;
                height: auto !important;
                z-index: 10000 !important;
                pointer-events: none !important;
                isolation: isolate !important;
                all: initial !important;
                font-family: Arial, sans-serif !important;
            }
            
            .rw-chat-isolated * {
                pointer-events: auto !important;
                box-sizing: border-box !important;
            }
            
            .rw-chat-btn-isolated {
    position: fixed !important;
    left: 15px !important;
    bottom: 15px !important;
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    background: linear-gradient(135deg, #00d97e, #00b368) !important;
    border: 2px solid white !important; /* <--- đã thêm viền trắng */
    color: white !important;
    font-size: 24px !important;
    cursor: pointer !important;
    z-index: 10001 !important;
    box-shadow: 0 4px 20px rgba(0,217,126,0.4) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    margin: 0 !important;
    -webkit-tap-highlight-color: transparent !important;
    touch-action: manipulation !important;
    overflow: hidden !important;
}
            
            .rw-chat-btn-isolated::after {
                content: "AI" !important;
                position: absolute !important;
                bottom: 5px !important;
                font-size: 11px !important;
                font-weight: bold !important;
                color: white !important;
                left: 0 !important;
                right: 0 !important;
                text-align: center !important;
            }
            
            .rw-chat-widget-isolated {
                position: fixed !important;
                left: 15px !important;
                bottom: 85px !important;
                width: calc(100vw - 30px) !important;
                max-width: 400px !important;
                height: 500px !important;
                background: white !important;
                border-radius: 12px !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important;
                z-index: 10002 !important;
                display: none !important;
                flex-direction: column !important;
                overflow: hidden !important;
                border: 1px solid #e2e8f0 !important;
                pointer-events: auto !important;
            }
            
            .rw-chat-widget-isolated.open {
                display: flex !important;
            }
            
            .rw-chat-header-isolated {
                background: linear-gradient(90deg, #00d97e, #00b368) !important;
                color: white !important;
                padding: 15px !important;
                display: flex !important;
                align-items: center !important;
                gap: 10px !important;
            }
            
            .rw-chat-avatar-isolated {
                width: 32px !important;
                height: 32px !important;
                border-radius: 8px !important;
                background: rgba(255,255,255,0.2) !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                font-weight: bold !important;
                font-size: 14px !important;
            }
            
            .rw-chat-title-isolated {
                font-weight: bold !important;
                font-size: 16px !important;
                flex: 1 !important;
            }
            
            .rw-chat-close-isolated {
                background: none !important;
                border: none !important;
                color: white !important;
                font-size: 18px !important;
                cursor: pointer !important;
                width: 30px !important;
                height: 30px !important;
                border-radius: 50% !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .rw-chat-body-isolated {
                flex: 1 !important;
                padding: 15px !important;
                overflow-y: auto !important;
                background: #f8fafc !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 12px !important;
            }
            
            .rw-chat-message-isolated {
                max-width: 85% !important;
                padding: 12px 16px !important;
                border-radius: 12px !important;
                font-size: 14px !important;
                line-height: 1.4 !important;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
            }
            
            .rw-chat-message-bot-isolated {
                background: white !important;
                color: #1e293b !important;
                border-bottom-left-radius: 4px !important;
                align-self: flex-start !important;
            }
            
            .rw-chat-message-user-isolated {
                background: linear-gradient(90deg, #00d97e, #00b368) !important;
                color: white !important;
                border-bottom-right-radius: 4px !important;
                align-self: flex-end !important;
            }
            
            .rw-chat-input-container-isolated {
                padding: 15px !important;
                background: white !important;
                border-top: 1px solid #e2e8f0 !important;
                display: flex !important;
                gap: 8px !important;
            }
            
            .rw-chat-input-isolated {
                flex: 1 !important;
                padding: 12px !important;
                border: 2px solid #00b368 !important;
                border-radius: 8px !important;
                font-size: 14px !important;
                outline: none !important;
                background: white !important;
                color: #1e293b !important;
            }
            
            .rw-chat-input-isolated:focus {
                border-color: #00d97e !important;
                box-shadow: 0 0 0 3px rgba(0, 217, 126, 0.2) !important;
            }
            
            .rw-chat-send-isolated {
                background: linear-gradient(90deg, #00d97e, #00b368) !important;
                color: white !important;
                border: none !important;
                padding: 12px 16px !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                font-weight: bold !important;
                font-size: 14px !important;
            }
            
            @media (min-width: 769px) {
                .rw-chat-btn-isolated {
                    left: 20px !important;
                    bottom: 20px !important;
                    width: 70px !important;
                    height: 70px !important;
                }
                .rw-chat-btn-isolated::after {
                    font-size: 12px !important;
                    bottom: 8px !important;
                }
                .rw-chat-widget-isolated {
                    left: 20px !important;
                    bottom: 100px !important;
                    width: 400px !important;
                }
            }
        `;
        
        // Thêm styles
        const styleEl = document.createElement('style');
        styleEl.textContent = styles;
        document.head.appendChild(styleEl);
        
        // Tạo HTML
        container.innerHTML = `
            <button class="rw-chat-btn-isolated" aria-label="Mở chat trợ lý Ruby Wings AI">🤖</button>
            <div class="rw-chat-widget-isolated">
                <div class="rw-chat-header-isolated">
                    <div class="rw-chat-avatar-isolated">AI</div>
                    <div class="rw-chat-title-isolated">Trợ lý Ruby Wings AI</div>
                    <button class="rw-chat-close-isolated" aria-label="Đóng chat">✕</button>
                </div>
                <div class="rw-chat-body-isolated">
                    <div class="rw-chat-message-isolated rw-chat-message-bot-isolated">
                        Chào bạn! Tôi là trợ lý Ruby Wings AI chuyên tư vấn về du lịch ... Tôi có thể giúp gì cho bạn?
                        <div style="font-size:11px; color:#94a3b8; margin-top:4px; text-align:right;">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>
                </div>
                <div class="rw-chat-input-container-isolated">
                    <input type="text" class="rw-chat-input-isolated" placeholder="Chatbot vẫn đang nâng cấp...">
                    <button class="rw-chat-send-isolated">Gửi</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(container);
        
        // Lấy elements
        const chatBtn = container.querySelector('.rw-chat-btn-isolated');
        const chatWidget = container.querySelector('.rw-chat-widget-isolated');
        const closeBtn = container.querySelector('.rw-chat-close-isolated');
        const sendBtn = container.querySelector('.rw-chat-send-isolated');
        const chatInput = container.querySelector('.rw-chat-input-isolated');
        const chatBody = container.querySelector('.rw-chat-body-isolated');
        
        let isOpen = false;
        
        // Event handlers đơn giản
        function toggleChat() {
            isOpen = !isOpen;
            chatWidget.classList.toggle('open', isOpen);
            if (isOpen) {
                setTimeout(() => chatInput.focus(), 100);
            }
        }
        
        function closeChat() {
            isOpen = false;
            chatWidget.classList.remove('open');
        }
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Thêm tin nhắn user
            addMessage(message, 'user');
            chatInput.value = '';
            
            // Hiển thị typing
            const typingMsg = addMessage('...', 'bot', true);
            
            // Gửi đến backend (FIX: Endpoint đúng /chat không có /api)
            fetch(BACKEND_URL + '/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                typingMsg.remove();
                const reply = data.reply || data.message || 'Không có phản hồi từ server.';
                addMessage(reply, 'bot');
            })
            .catch(error => {
                typingMsg.remove();
                addMessage('Xin lỗi, dịch vụ tạm thời gián đoạn. Vui lòng thử lại.', 'bot');
                console.error('Chat error:', error);
            });
        }
        
        function addMessage(text, sender, isTyping = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `rw-chat-message-isolated rw-chat-message-${sender}-isolated`;
            
            if (isTyping) {
                messageDiv.innerHTML = `
                    <div style="display:flex; gap:4px; align-items:center;">
                        <div style="width:6px; height:6px; border-radius:50%; background:#00d97e; animation: bounce 1s infinite"></div>
                        <div style="width:6px; height:6px; border-radius:50%; background:#00d97e; animation: bounce 1s infinite 0.1s"></div>
                        <div style="width:6px; height:6px; border-radius:50%; background:#00d97e; animation: bounce 1s infinite 0.2s"></div>
                    </div>
                    <style>
                        @keyframes bounce {
                            0%, 100% { transform: translateY(0); }
                            50% { transform: translateY(-5px); }
                        }
                    </style>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div>${text}</div>
                    <div style="font-size:11px; opacity:0.7; margin-top:4px; text-align:${sender === 'user' ? 'left' : 'right'};">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
            }
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
            return messageDiv;
        }
        
        // Gắn event listeners
        chatBtn.addEventListener('click', toggleChat);
        closeBtn.addEventListener('click', closeChat);
        sendBtn.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // Đóng khi click bên ngoài
        document.addEventListener('click', (e) => {
            if (isOpen && !chatWidget.contains(e.target) && !chatBtn.contains(e.target)) {
                closeChat();
            }
        });
    };
    
    // Khởi tạo khi trang load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createIsolatedWidget);
    } else {
        createIsolatedWidget();
    }
})();

</script>
<!-- NÚT GỌI ĐIỆN RUBY WINGS - Đặt trước thẻ đóng </body> -->
<div id="ruby-call-widget" style="position: fixed; z-index: 10001;">
   <button id="ruby-call-button" style="background: linear-gradient(135deg, #00d97e, #00b368) !important; color: white; border: 2px solid white; border-radius: 50%; cursor: pointer; box-shadow: 0 6px 25px rgba(0, 217, 126, 0.4); display: flex; align-items: center; justify-content: center; transition: all 0.3s; outline: none;">
        📞
    </button>
</div>

<!-- MODAL NHẬP SỐ ĐIỆN THOẠI -->
<div id="ruby-call-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10002; align-items: center; justify-content: center;">
    <div style="background: linear-gradient(135deg, #1a5f23 0%, #0d3b1a 100%); border-radius: 16px; padding: 30px; width: 90%; max-width: 420px; box-shadow: 0 15px 40px rgba(0,0,0,0.5); border: 2px solid #27ae60;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h3 style="color: white; margin: 0; font-size: 22px; font-weight: 600; text-shadow: 1px 1px 3px rgba(0,0,0,0.3);">📞 GỌI CHO CHÚNG TÔI</h3>
            <button id="ruby-close-modal" style="background: none; border: none; font-size: 28px; cursor: pointer; color: white; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">×</button>
        </div>
        
        <div style="margin-bottom: 25px;">
            <p style="color: white; margin-bottom: 10px; font-size: 16px; font-weight: 500;">Nhập số của Bạn để gọi chúng tôi:</p>
            <input type="tel" id="ruby-phone-input" 
                   style="width: 100%; padding: 15px; background: white; color: black; border: 3px solid #27ae60; border-radius: 10px; font-size: 18px; font-weight: 500; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);"
                   placeholder="Ví dụ: 0332 510 486" 
                   pattern="[0-9]{10,11}">
            <p style="color: #d1e7dd; font-size: 13px; margin-top: 8px; font-weight: 400;">Chúng tôi sẽ gọi lại cho bạn trong sớm nhất có thể</p>
        </div>
        
        <div style="display: flex; gap: 12px;">
            <button id="ruby-call-regular" 
                    style="flex: 1; background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); color: white; border: none; padding: 16px; border-radius: 10px; cursor: pointer; font-size: 17px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4); transition: all 0.3s; min-height: 55px;">
                <span style="font-size: 20px;">📞</span>
                <span>GỌI BẰNG SỐ</span>
            </button>
            <button id="ruby-call-zalo" 
                    style="flex: 1; background: linear-gradient(135deg, #0068ff 0%, #0052cc 100%); color: white; border: none; padding: 16px; border-radius: 10px; cursor: pointer; font-size: 17px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(0, 104, 255, 0.4); transition: all 0.3s; min-height: 55px;">
                <span><img src="https://img.icons8.com/color/20/000000/zalo.png" style="width: 20px; height: 20px; filter: brightness(0) invert(1);"></span>
                <span>GỌI ZALO</span>
            </button>
        </div>
        
        <p id="ruby-call-message" style="margin-top: 20px; text-align: center; font-size: 14px; min-height: 22px; color: white; font-weight: 500;"></p>
    </div>
</div>

<style>
/* ===== STYLES FOR ALL DEVICES ===== */
#ruby-call-widget {
    position: fixed !important;
    z-index: 10001 !important;
}

#ruby-call-button {
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

#ruby-call-button::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
    z-index: -1;
}

#ruby-call-button:hover::after {
    opacity: 1;
}

#ruby-close-modal:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: rotate(90deg);
}

/* DÒNG CODE THAY THẾ */
#ruby-call-regular:hover {
    transform: translateY(-3px) !important;
    box-shadow: 0 8px 20px rgba(0, 217, 126, 0.6) !important;
    background: linear-gradient(135deg, #00d97e, #00b368) !important;
    filter: brightness(1.1);
}

#ruby-call-zalo:hover {
    transform: translateY(-3px) !important;
    box-shadow: 0 8px 20px rgba(0, 104, 255, 0.6) !important;
    background: linear-gradient(135deg, #0057d9 0%, #0047b3 100%) !important;
}

/* Input focus effects */
#ruby-phone-input:focus {
    outline: none;
    border-color: #2ecc71 !important;
    box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3) !important;
}

/* Animation cho modal */
@keyframes rubyModalFadeIn {
    from { 
        opacity: 0; 
        transform: translateY(-30px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

@keyframes rubyButtonPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

#ruby-call-modal > div {
    animation: rubyModalFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* Pulsing effect for call button */
.ruby-pulse {
    animation: rubyButtonPulse 2s infinite;
}

/* ===== DESKTOP STYLES (default) ===== */
@media (min-width: 769px) {
    #ruby-call-widget {
        bottom: 105px;
        left: 24px;
    }
    
    #ruby-call-button {
        width: 70px;
        height: 70px;
        font-size: 30px;
    }
}

/* ===== MOBILE STYLES ===== */
@media (max-width: 768px) {
    #ruby-call-widget {
        bottom: 85px;
        left: 15px;
    }
    
    #ruby-call-button {
        width: 60px;
        height: 60px;
        font-size: 26px;
    }
    
    #ruby-call-modal > div {
        padding: 25px !important;
        margin: 15px;
    }
    
    #ruby-phone-input {
        padding: 14px !important;
        font-size: 16px !important;
    }
    
    #ruby-call-regular,
    #ruby-call-zalo {
        padding: 14px !important;
        font-size: 16px !important;
        min-height: 50px !important;
    }
}

/* ===== EXTRA SMALL DEVICES ===== */
@media (max-width: 480px) {
    #ruby-call-widget {
        bottom: 85px;
        left: 15px;
    }
    
    #ruby-call-button {
        width: 60px;
        height: 60px;
        font-size: 24px;
    }
    
    #ruby-call-modal > div {
        padding: 20px !important;
    }
    
    h3 {
        font-size: 20px !important;
    }
}

/* ===== PRINT STYLES (hide on print) ===== */
@media print {
    #ruby-call-widget,
    #ruby-call-modal {
        display: none !important;
    }
}

/* ===== DARK MODE SUPPORT ===== */
@media (prefers-color-scheme: dark) {
    #ruby-phone-input {
        background: white !important;
        color: black !important;
    }
}
</style>

<script>
// Biến toàn cục để track trạng thái
let rubyCallWidgetInitialized = false;
let rubyCallWidgetVisible = true;

// Số điện thoại cố định của công ty
const RUBY_WINGS_PHONE = "0332510486";

// Hàm khởi tạo widget gọi điện
function initRubyCallWidget() {
    if (rubyCallWidgetInitialized) return;
    rubyCallWidgetInitialized = true;
    
    // DOM Elements
    const callButton = document.getElementById('ruby-call-button');
    const callModal = document.getElementById('ruby-call-modal');
    const closeButton = document.getElementById('ruby-close-modal');
    const phoneInput = document.getElementById('ruby-phone-input');
    const callRegularButton = document.getElementById('ruby-call-regular');
    const callZaloButton = document.getElementById('ruby-call-zalo');
    const messageElement = document.getElementById('ruby-call-message');
    
    // Áp dụng positioning cho widget
    function applyWidgetPosition() {
        const widget = document.getElementById('ruby-call-widget');
        if (window.innerWidth >= 769) {
            // Desktop positioning
            widget.style.bottom = '105px';
            widget.style.left = '24px';
        } else {
            // Mobile positioning
            widget.style.bottom = '85px';
            widget.style.left = '15px';
        }
    }
    
    // Apply initial position
    applyWidgetPosition();
    
    // Thêm hiệu ứng pulse cho nút
    callButton.classList.add('ruby-pulse');
    
    // Mở modal khi click nút gọi điện
    callButton.addEventListener('click', () => {
        callModal.style.display = 'flex';
        phoneInput.focus();
        phoneInput.select();
        
        // Tạm dừng hiệu ứng pulse khi mở modal
        callButton.classList.remove('ruby-pulse');
    });
    
    // Đóng modal
    closeButton.addEventListener('click', () => {
        callModal.style.display = 'none';
        messageElement.textContent = '';
        phoneInput.value = '';
        
        // Khôi phục hiệu ứng pulse
        setTimeout(() => {
            callButton.classList.add('ruby-pulse');
        }, 500);
    });
    
    // Click bên ngoài để đóng modal
    callModal.addEventListener('click', (e) => {
        if (e.target === callModal) {
            callModal.style.display = 'none';
            messageElement.textContent = '';
            phoneInput.value = '';
            
            // Khôi phục hiệu ứng pulse
            setTimeout(() => {
                callButton.classList.add('ruby-pulse');
            }, 500);
        }
    });
    
    // ESC key để đóng modal
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && callModal.style.display === 'flex') {
            callModal.style.display = 'none';
            messageElement.textContent = '';
            phoneInput.value = '';
            
            setTimeout(() => {
                callButton.classList.add('ruby-pulse');
            }, 500);
        }
    });
    
    // Hàm lưu lead vào hệ thống
    async function saveRubyLead(phoneNumber, callType) {
        // Validate số điện thoại
        const cleanPhone = phoneNumber.replace(/\D/g, '');
        if (cleanPhone.length < 10 || cleanPhone.length > 11) {
            throw new Error('Số điện thoại không hợp lệ. Vui lòng nhập 10-11 chữ số');
        }
        
        // Chuẩn bị dữ liệu lead
        const leadData = {
            phone: cleanPhone,
            source_channel: "Website",
            action_type: "Click Call Button",
            page_url: window.location.href,
            contact_name: "Khách yêu cầu gọi lại",
            service_interest: "",
            note: callType === 'zalo' ? 
                  "Khách yêu cầu gọi lại qua Zalo" : 
                  "Khách yêu cầu gọi lại trực tiếp"
        };
        
        // Gửi đến backend API
        const response = await fetch('https://ruby-wings-chatbot.onrender.com/api/save-lead', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(leadData)
        });
        
        if (!response.ok) {
            throw new Error('Lỗi kết nối server. Vui lòng thử lại');
        }
        
        return await response.json();
    }
    
    // Hàm xử lý gọi điện
    async function handleCall(callType = 'regular') {
        const eventId = crypto.randomUUID();
        const phoneNumber = phoneInput.value.trim();
        
        if (!phoneNumber) {
            messageElement.textContent = '⚠️ Vui lòng nhập số điện thoại';
            messageElement.style.color = '#ffcc00';
            phoneInput.focus();
            return;
        }
        
        // Hiển thị trạng thái đang xử lý
        const originalRegularText = callRegularButton.innerHTML;
        const originalZaloText = callZaloButton.innerHTML;
        
        if (callType === 'regular') {
            callRegularButton.innerHTML = '<span style="font-size: 20px;">⏳</span><span>ĐANG XỬ LÝ...</span>';
            callRegularButton.disabled = true;
            callRegularButton.style.opacity = '0.8';
        } else {
            callZaloButton.innerHTML = '<span style="font-size: 20px;">⏳</span><span>ĐANG XỬ LÝ...</span>';
            callZaloButton.disabled = true;
            callZaloButton.style.opacity = '0.8';
        }
        
        messageElement.textContent = '⏳ Đang lưu thông tin và kết nối...';
        messageElement.style.color = '#ffcc00';
        
        try {
            // 1. Lưu lead vào hệ thống
            const result = await saveRubyLead(phoneNumber, callType);
            // Track Call / Zalo conversion (Meta CAPI)
            fetch('https://ruby-wings-chatbot.onrender.com/api/track-call', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    event_id: window.RW_EVENT_ID, // ✅ dùng event_id chung toàn site
                    phone: phoneNumber.replace(/\D/g, ''),
                    action: callType === 'zalo' ? 'Zalo Click' : 'Phone Call'
                })
            });


            // 2. Hiển thị thông báo thành công
            messageElement.innerHTML = '✅ <strong>THÀNH CÔNG!</strong> Đã gửi thông tin';
            messageElement.style.color = '#2ecc71';
            
            // 3. Chuyển hướng đến cuộc gọi/Zalo CÔNG TY (FIX: Gọi đến số công ty thay vì số khách hàng)
            setTimeout(() => {
                if (callType === 'zalo') {
                    // Mở Zalo CÔNG TY trong tab mới
                    window.open(`https://zalo.me/${RUBY_WINGS_PHONE}`, '_blank', 'noopener,noreferrer');
                } else {
                    // Gọi điện đến SỐ CÔNG TY
                    window.location.href = `tel:${RUBY_WINGS_PHONE}`;
                }
                
                // Đóng modal sau 1.5 giây
                setTimeout(() => {
                    callModal.style.display = 'none';
                    phoneInput.value = '';
                    messageElement.textContent = '';
                    
                    // Khôi phục hiệu ứng pulse
                    setTimeout(() => {
                        callButton.classList.add('ruby-pulse');
                    }, 500);
                }, 1500);
            }, 1000);
            
        } catch (error) {
            // Xử lý lỗi
            console.error('Ruby Call Widget Error:', error);
            messageElement.innerHTML = `❌ <strong>${error.message}</strong>`;
            messageElement.style.color = '#ff6b6b';
            
            // Vẫn cho phép gọi nếu API fail (fallback - GỌI ĐẾN CÔNG TY)
            setTimeout(() => {
                const userConfirmed = confirm('Hệ thống đang bận. Bạn vẫn muốn tiếp tục gọi không?');
                
                if (userConfirmed) {
                    if (callType === 'zalo') {
                        window.open(`https://zalo.me/${RUBY_WINGS_PHONE}`, '_blank', 'noopener,noreferrer');
                    } else {
                        window.location.href = `tel:${RUBY_WINGS_PHONE}`;
                    }
                    callModal.style.display = 'none';
                    phoneInput.value = '';
                    messageElement.textContent = '';
                }
            }, 2000);
        } finally {
            // Khôi phục trạng thái nút
            if (callType === 'regular') {
                setTimeout(() => {
                    callRegularButton.innerHTML = originalRegularText;
                    callRegularButton.disabled = false;
                    callRegularButton.style.opacity = '1';
                }, 1000);
            } else {
                setTimeout(() => {
                    callZaloButton.innerHTML = originalZaloText;
                    callZaloButton.disabled = false;
                    callZaloButton.style.opacity = '1';
                }, 1000);
            }
        }
    }
    
    // Gắn sự kiện cho nút gọi thường
    callRegularButton.addEventListener('click', () => handleCall('regular'));
    
    // Gắn sự kiện cho nút gọi Zalo
    callZaloButton.addEventListener('click', () => handleCall('zalo'));
    
    // Cho phép nhấn Enter để gọi thường
    phoneInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            handleCall('regular');
        }
    });
    
    // Auto-format số điện thoại
    phoneInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        
        if (value.length > 0) {
            if (value.length <= 4) {
                value = value;
            } else if (value.length <= 7) {
                value = `${value.slice(0, 4)} ${value.slice(4)}`;
            } else {
                value = `${value.slice(0, 4)} ${value.slice(4, 7)} ${value.slice(7, 11)}`;
            }
        }
        
        e.target.value = value;
    });
    
    // Điều chỉnh vị trí nếu có chatbot
    function adjustPositionForChatbot() {
        const chatWidget = document.querySelector('#chatWidget, .chat-widget, [id*="chat"], [class*="chat"], .tawk-button, .zalo-chat-widget');
        if (chatWidget) {
            const chatRect = chatWidget.getBoundingClientRect();
            const callWidget = document.getElementById('ruby-call-widget');
            
            // Đặt nút gọi điện cao hơn nút chatbot 80px
            callWidget.style.bottom = `${chatRect.height + 80}px`;
        }
    }
    
    // Re-apply position on resize
    window.addEventListener('resize', () => {
        applyWidgetPosition();
        adjustPositionForChatbot();
    });
    
    // Kiểm tra và điều chỉnh mỗi 1 giây (phòng trường hợp chatbot load sau)
    const positionCheckInterval = setInterval(() => {
        adjustPositionForChatbot();
    }, 1000);
    
    // Initial adjustments
    setTimeout(() => {
        adjustPositionForChatbot();
    }, 1000);
    
    console.log('✅ Ruby Call Widget đã sẵn sàng - Phiên bản hoàn thiện');
}

// Khởi tạo khi DOM ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initRubyCallWidget);
} else {
    initRubyCallWidget();
}

// Đảm bảo widget vẫn hoạt động khi chuyển trang trong SPA
document.addEventListener('click', (e) => {
    if (e.target.matches('a[href*="#"]') || e.target.closest('a[href*="#"]')) {
        // Giữ widget hiển thị khi chuyển anchor link
        setTimeout(() => {
            if (window.rubyCallWidgetInitialized) {
                const widget = document.getElementById('ruby-call-widget');
                widget.style.display = 'block';
            }
        }, 100);
    }
});

// Chống ẩn widget khi scroll
let lastScrollTop = 0;
window.addEventListener('scroll', () => {
    const st = window.pageYOffset || document.documentElement.scrollTop;
    
    // Luôn hiển thị widget, không ẩn khi scroll
    const widget = document.getElementById('ruby-call-widget');
    if (widget) {
        widget.style.display = 'block';
        widget.style.opacity = '1';
    }
    
    lastScrollTop = st <= 0 ? 0 : st;
}, false);
</script>
</body>
</html>